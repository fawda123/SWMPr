<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Estimate ecosystem metabolism using the Odum open-water method.  Estimates of daily integrated gross production, total respiration, and net ecosystem metabolism are returned."><title>Ecosystem metabolism — ecometab • SWMPr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ecosystem metabolism — ecometab"><meta property="og:description" content="Estimate ecosystem metabolism using the Odum open-water method.  Estimates of daily integrated gross production, total respiration, and net ecosystem metabolism are returned."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SWMPr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.5.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Overview.html">Overview</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fawda123/SWMPr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Ecosystem metabolism</h1>
      <small class="dont-index">Source: <a href="https://github.com/fawda123/SWMPr/blob/HEAD/R/ecometab.R" class="external-link"><code>R/ecometab.R</code></a></small>
      <div class="d-none name"><code>ecometab.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimate ecosystem metabolism using the Odum open-water method.  Estimates of daily integrated gross production, total respiration, and net ecosystem metabolism are returned.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ecometab</span><span class="op">(</span><span class="va">dat_in</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for swmpr</span></span>
<span><span class="fu">ecometab</span><span class="op">(</span><span class="va">dat_in</span>, depth_val <span class="op">=</span> <span class="cn">NULL</span>, metab_units <span class="op">=</span> <span class="st">"mmol"</span>, trace <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for default</span></span>
<span><span class="fu">ecometab</span><span class="op">(</span></span>
<span>  <span class="va">dat_in</span>,</span>
<span>  <span class="va">tz</span>,</span>
<span>  <span class="va">lat</span>,</span>
<span>  <span class="va">long</span>,</span>
<span>  depth_val <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metab_units <span class="op">=</span> <span class="st">"mmol"</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dat_in</dt>
<dd><p>Input data object, see details for required time series</p></dd>


<dt>...</dt>
<dd><p>arguments passed to other methods</p></dd>


<dt>depth_val</dt>
<dd><p>numeric value for station depth (m) if time series is not available</p></dd>


<dt>metab_units</dt>
<dd><p>chr indicating desired units of output for oxygen, either as mmol or grams</p></dd>


<dt>trace</dt>
<dd><p>logical indicating if progress is shown in the console</p></dd>


<dt>tz</dt>
<dd><p>chr string for timezone, e.g., 'America/Chicago'</p></dd>


<dt>lat</dt>
<dd><p>numeric for latitude</p></dd>


<dt>long</dt>
<dd><p>numeric for longitude (negative west of prime meridian)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code>data.frame</code> of daily integrated metabolism estimates is returned. If a <code><a href="swmpr.html">swmpr</a></code> object is passed to the function, this <code>data.frame</code> is added to the <code>metab</code> attribute and the original object is returned.  See the examples for retrieval from a <code>swmpr</code> object.  The metabolism <code>data.frame</code> contains the following:</p><dl><dt><code>date</code></dt>
<dd><p>The metabolic day, defined as the 24 hour period starting at sunrise (calculated using <code><a href="metab_day.html">metab_day</a></code>)</p></dd>

 <dt><code>DOF_d</code></dt>
<dd><p>Mean DO flux during day hours, mmol m-2 hr-1. Day hours are calculated using the <code><a href="metab_day.html">metab_day</a></code> function.</p></dd>

 <dt><code>D_d</code></dt>
<dd><p>Mean air-sea gas exchange of DO during day hours, mmol m-2 hr-1</p></dd>

 <dt><code>DOF_n</code></dt>
<dd><p>Mean DO flux during night hours, mmol m-2 hr-1</p></dd>

 <dt><code>D_n</code></dt>
<dd><p>Mean air-sea gas exchange of DO during night hours, mmol m-2 hr-1</p></dd>

 <dt><code>Pg</code></dt>
<dd><p>Gross production, mmol m-2 d-1, calculated as ((DOF_d - D_d) - (DOF_n - D_n)) * day hours</p></dd>

 <dt><code>Rt</code></dt>
<dd><p>Total respiration, mmol m-2 d-1, calculated as (DOF_n - D_n) * 24</p></dd>

 <dt><code>NEM</code></dt>
<dd><p>Net ecosytem metabolism, mmol m-2 d-1, calculated as Pg + Rt</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Input data include both water quality and weather time series, which are typically collected with independent instrument systems.  For SWMP data, this requires merging water quality and meteorology <code>swmpr</code> data objects using the <code><a href="comb.html">comb</a></code> function (see examples).  For the default method not using SWMP data, the input <code>data.frame</code> must have columns named <code>datetimestamp</code> (date/time column, as <code><a href="https://rdrr.io/r/base/DateTimeClasses.html" class="external-link">POSIXct</a></code> object), <code>do_mgl</code> (dissolved oxygen, mg/L), <code>depth</code> (depth, m), <code>atemp</code> (air temperature, C), <code>sal</code> (salinity, psu), <code>temp</code> (water temperature, C), <code>wspd</code> (wind speed, m/s), and <code>bp</code> (barometric pressure, mb).</p>
<p>The open-water method is a common approach to quantify net ecosystem metabolism using a mass balance equation that describes the change in dissolved oxygen over time from the balance between photosynthetic and respiration processes, corrected using an empirically constrained air-sea gas diffusion model (see Ro and Hunt 2006, Thebault et al. 2008).  The diffusion-corrected DO flux estimates are averaged separately over each day and night of the time series. The nighttime average DO flux is used to estimate respiration rates, while the daytime DO flux is used to estimate net primary production. To generate daily integrated rates, respiration rates are assumed constant such that hourly night time DO flux rates are multiplied by 24. Similarly, the daytime DO flux rates are multiplied by the number of daylight hours, which varies with location and time of year, to yield net daytime primary production. Respiration rates are subtracted from daily net production estimates to yield gross production rates.  The metabolic day is considered the 24 hour period between sunsets on two adjacent calendar days.</p>
<p>Areal rates for gross production and total respiration are based on volumetric rates normalized to the depth of the water column at the sampling location, which is assumed to be well-mixed, such that the DO sensor is reflecting the integrated processes in the entire water column (including the benthos).  Water column depth is calculated as the mean value of the depth variable across the time series in the <code><a href="swmpr.html">swmpr</a></code> object.  Depth values are floored at one meter for very shallow stations and 0.5 meters is also added to reflect the practice of placing sensors slightly off of the bottom. A user-supplied depth value can also be passed to the <code>depth_val</code> argument, either as a single value that is repeated or as a vector equal in length to the number of rows in the input data.  An accurate depth value should be used as this acts as a direct scalar on metabolism estimates.</p>
<p>The air-sea gas exchange model is calibrated with wind data either collected at, or adjusted to, wind speed at 10 m above the surface. The metadata should be consulted for exact height.  The value can be changed manually using a <code>height</code> argument, which is passed to <code><a href="calckl.html">calckl</a></code>.</p>
<p>A minimum of three records are required for both day and night periods to calculate daily metabolism estimates.  Occasional missing values for air temperature, barometric pressure, and wind speed are replaced with the climatological means (hourly means by month) for the period of record using adjacent data within the same month as the missing data.</p>
<p>All DO calculations within the function are done using molar units (e.g., mmol O2 m-3).  The output can be returned as mass units by setting <code>metab_units = 'grams'</code> (i.e., 1mol = 32 g O2, which multiplies all estimates by 32 g mol-1/1000 mg/g).  Input data must be in standard mass units for DO (mg L-1).</p>
<p>The specific approach for estimating metabolism with the open-water method is described in Caffrey et al. 2013 and references cited therein.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Caffrey JM, Murrell MC, Amacker KS, Harper J, Phipps S, Woodrey M. 2013. Seasonal and inter-annual patterns in primary production, respiration and net ecosystem metabolism in 3 estuaries in the northeast Gulf of Mexico. Estuaries and Coasts. 37(1):222-241.</p>
<p>Odum HT. 1956. Primary production in flowing waters. Limnology and Oceanography. 1(2):102-117.</p>
<p>Ro KS, Hunt PG. 2006. A new unified equation for wind-driven surficial oxygen transfer into stationary water bodies. Transactions of the American Society of Agricultural and Biological Engineers. 49(5):1615-1622.</p>
<p>Thebault J, Schraga TS, Cloern JE, Dunlavey EG. 2008. Primary production and carrying capacity of former salt ponds after reconnection to San Francisco Bay. Wetlands. 28(3):841-851.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="calckl.html">calckl</a></code> for estimating the oxygen mass transfer coefficient used with the air-sea gas exchange model, <code><a href="comb.html">comb</a></code> for combining <code>swmpr</code> objects, <code><a href="metab_day.html">metab_day</a></code> for identifying the metabolic day for each observation in the time series, <code><a href="plot_metab.html">plot_metab</a></code> for plotting the results, and <code><a href="aggremetab.html">aggremetab</a></code> for aggregating the metabolism attribute.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## import water quality and weather data, qaqc</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">apadbwq</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">apaebmet</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">wq</span> <span class="op">&lt;-</span> <span class="fu"><a href="qaqc.html">qaqc</a></span><span class="op">(</span><span class="va">apadbwq</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">met</span> <span class="op">&lt;-</span> <span class="fu"><a href="qaqc.html">qaqc</a></span><span class="op">(</span><span class="va">apaebmet</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## combine</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="comb.html">comb</a></span><span class="op">(</span><span class="va">wq</span>, <span class="va">met</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## output units in grams of oxygen</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">ecometab</span><span class="op">(</span><span class="va">dat</span>, metab_units <span class="op">=</span> <span class="st">'grams'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">'metabolism'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## manual input of integration depth</span></span></span>
<span class="r-in"><span><span class="co">## NA values must be filled</span></span></span>
<span class="r-in"><span><span class="va">dat_fill</span> <span class="op">&lt;-</span> <span class="fu">na.approx</span><span class="op">(</span><span class="va">dat</span>, params <span class="op">=</span> <span class="st">'depth'</span>, maxgap <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">depth</span> <span class="op">&lt;-</span> <span class="va">dat_fill</span><span class="op">$</span><span class="va">depth</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">ecometab</span><span class="op">(</span><span class="va">dat</span>, metab_units <span class="op">=</span> <span class="st">'grams'</span>, depth_val <span class="op">=</span> <span class="va">depth</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">'metabolism'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## use the default method for ecometab with a generic data frame</span></span></span>
<span class="r-in"><span><span class="co">## first recreate a generic object from the sample data</span></span></span>
<span class="r-in"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'datetimestamp'</span>, <span class="st">'do_mgl'</span>, <span class="st">'depth'</span>, <span class="st">'atemp'</span>, <span class="st">'sal'</span>, <span class="st">'temp'</span>, <span class="st">'wspd'</span>, <span class="st">'bp'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span>, <span class="va">cols</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">ecometab</span><span class="op">(</span><span class="va">dat</span>, tz <span class="op">=</span> <span class="st">'America/Jamaica'</span>, lat <span class="op">=</span> <span class="fl">29.67</span>, long <span class="op">=</span> <span class="op">-</span><span class="fl">85.06</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Marcus W. Beck.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

